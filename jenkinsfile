# Perbaiki Jenkinsfile agar mengarah ke repository yang benar
cat > Jenkinsfile << 'EOF'
pipeline {
    agent any
    
    environment {
        REPO_URL = 'https://github.com/citrasn/citrasn.git'
        NGROK_URL = 'https://colligative-steellike-ophelia.ngrok-free.dev'
    }
    
    stages {
        stage('1. Checkout Repository') {
            steps {
                echo 'üöÄ STARTING CI/CD PIPELINE'
                echo 'üì¶ Repository: citrasn/citrasn'
                
                checkout([
                    $class: 'GitSCM',
                    branches: [[name: '*/main']],
                    userRemoteConfigs: [[
                        url: 'https://github.com/citrasn/citrasn.git'
                    ]]
                ])
                
                bat '''
                    echo ============================
                    echo REPOSITORY INFO
                    echo ============================
                    echo URL: https://github.com/citrasn/citrasn
                    echo Branch: main
                    dir /B
                    echo ============================
                '''
            }
        }
        
        stage('2. Create PHP Files') {
            steps {
                echo 'üìù CREATING PHP FILES...'
                
                script {
                    // Create index.php if not exists
                    if (!fileExists('index.php')) {
                        writeFile file: 'index.php', text: '''<?php
echo "================================\\n";
echo "     CI/CD PIPELINE - TUGAS 2\\n";
echo "================================\\n";
echo "Repository: citrasn/citrasn\\n";
echo "Time: " . date("Y-m-d H:i:s") . "\\n";
echo "PHP Version: " . PHP_VERSION . "\\n";
echo "================================\\n\\n";

echo "üéØ TUGAS 2: Running PHP Script\\n";
echo "Command: powershell \\"php index.php\\"\\n";
echo "Status: ‚úÖ EXECUTING...\\n\\n";

// Simple calculations
$a = 15;
$b = 3;
echo "15 + 3 = " . ($a + $b) . "\\n";
echo "15 - 3 = " . ($a - $b) . "\\n";
echo "15 * 3 = " . ($a * $b) . "\\n";
echo "15 / 3 = " . ($a / $b) . "\\n\\n";

echo "‚úÖ TUGAS 2 COMPLETED!\\n";
echo "‚úÖ powershell \\"php index.php\\" executed!\\n";
echo "================================\\n";
?>
'''
                        echo '‚úÖ Created index.php'
                    }
                    
                    // Create simple test file
                    writeFile file: 'test.php', text: '''<?php
// Simple test file
function testAddition($a, $b) {
    return $a + $b;
}

echo "Test: " . testAddition(5, 3) . "\\n";
?>
'''
                }
            }
        }
        
        stage('3. Run PHP Script - TUGAS 2') {
            steps {
                echo 'üêò TUGAS 2: RUN PHP SCRIPT'
                echo 'üìå Command: powershell "php index.php"'
                
                powershell '''
                    Write-Host "=== EXECUTING TUGAS 2 ===" -ForegroundColor Cyan
                    Write-Host "Command: php index.php" -ForegroundColor Yellow
                    php index.php
                    if ($LASTEXITCODE -eq 0) {
                        Write-Host "‚úÖ TUGAS 2: SUCCESS!" -ForegroundColor Green
                    }
                '''
            }
        }
        
        stage('4. Simple Test') {
            steps {
                echo 'üß™ RUNNING SIMPLE TESTS'
                
                bat '''
                    echo ============================
                    echo CI/CD TEST RESULTS
                    echo ============================
                    echo Build: %BUILD_NUMBER%
                    echo Time: %date% %time%
                    echo Repo: citrasn/citrasn
                    echo Status: SUCCESS
                    echo ============================
                '''
            }
        }
    }
    
    post {
        always {
            echo 'üèÅ PIPELINE COMPLETED'
            echo 'üîó GitHub: https://github.com/citrasn/citrasn'
            echo 'üîó Jenkins: https://colligative-steellike-ophelia.ngrok-free.dev'
        }
        success {
            echo '‚úÖ ‚úÖ ‚úÖ CI/CD PIPELINE BERHASIL! ‚úÖ ‚úÖ ‚úÖ'
            echo '‚úÖ TUGAS 2: powershell "php index.php" - COMPLETED!'
        }
    }
}
EOF